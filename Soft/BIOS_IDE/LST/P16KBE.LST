.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49
Table of contents

    2- 462	common definitions for bios monitor
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 1


      1					.enabl  lc
      2					.enabl	ama
      3					.enabl  gbl
      4					.mcall	.push,.pop
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 3
Common definitions for bios monitor

      2
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4
Common definitions for bios monitor

      1		177560 				KBCSR	= 177560
      2		177562 				KBBUF	= 177562
      3		174106 				KBESC   = 174106
      4		174110 				CBBUF	= 174110
      5		000060 				KBVEC	= 60
      6		000031 				T.WAIT	= 25.
      7		000005 				T.REPT	= 5
      8
      9		147560 				KB.CSR	= <KBCSR & 7777> + L.REG
     10		147562 				KB.BUF	= <KBBUF & 7777> + L.REG
     11		144106 				KB.ESC  = <KBESC & 7777> + L.REG
     12		144110 				CB.BUF	= <CBBUF & 7777> + L.REG
     13
     14		000000'			RD.PTR=.
     15	000000	177560 	177677 	000000 	KSTBL:	.WORD   KBCSR,  ^C100,  0,   2000, W.KCSR, 0
	000006	002000 	002322'	000000
     16	000014	177562 	177777 	000000 	KBTBL:	.WORD	KBBUF,  ^C0,    0,   4000, R.KBUF,-1
	000022	004000 	002176'	177777
     17	000030	174106 	000000 	000000 	KETBL:	.WORD	KBESC,    0,    0,   2000, W.ESC, -1
	000036	002000 	000336'	177777
     18	000044	174110 	000000 	000000 	CBTBL:	.WORD   CBBUF,    0,    0,   2000, WC.BUF,-1
	000052	002000 	000760'	177777
     19
     20	000060	   113 	   145 	   171 	pname:	.asciz	/Keyboard process/
	000063	   142 	   157 	   141
	000066	   162 	   144 	   040
	000071	   160 	   162 	   157
	000074	   143 	   145 	   163
	000077	   163 	   000
     21					.even
     22
     23	000102				KBEINI::
     24	000102	012702 	000060'			mov	#pname,	r2
     25	000106	004737 	000000G			call	wname
     26	000112	062700 	000050 			ADD	#P.CPRC,R0
     27	000116	010037 	000334'			MOV	R0,	KB.CPRC
     28
     29	000122	012737 	005200'	004636'		MOV	#ESC$HEA, ESC.HEAP
     30	000130	012737 	004634'	004634'		MOV	#REQ.PTR, REQ.PTR
     31
     32	000136					PROREG	#CBTBL
     33
     34	000146					PROREG	#KETBL
     35
     36	000156					PROREG	#KSTBL
     37	000166	010037 	004670'			MOV	R0,     KS.COPY
     38
     39	000172					PROREG	#KBTBL
     40	000202	010037 	004672'			MOV	R0,     KB.COPY
     41
     42	000206	012700 	001036'			MOV	#KBE.INT,R0
     43	000212					PROVEC	#V.KBD
     44
     45	000222					SETPRI	#50000-M.KBD
     46	000232				        DCHAR	#8.*400+70
     47	000242	012737 	000020 	004660'		MOV	#M.KBD, KB.MASK
     48	000250	012737 	000360 	161066 	        MOV	#360,	KBDCSR
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-1
Common definitions for bios monitor

     49	000256	012737 	000002'	000000'		MOV	#RD.PTR+2,RD.PTR
     50	000264	012737 	000002'	000244'		MOV	#RD.PTR+2,WR.PTR
     51	000272	010706 				MOV	PC,	SP
     52		000244'			WR.PTR=.-30
     53	000274				KBESTK::
     54
     55
     56	000274				KBE:
     57	000274	012700 	002320'			mov	#ret,	r0
     58	000300	010001 				mov	r0,	r1
     59	000302	010002 				mov	r0,	r2
     60	000304	013703 	004664'			MOV	KB.TIME, R3
     61	000310	012704 	001476'			MOV	#K.REPT,R4
     62	000314					WAITINT KB.MASK
     63	000324					.PUSH	<#KBE,R0>
     64	000332	004112 				JSR	R1,	(R2)
     65
     66	000334				KB.CPRC: .BLKW	 1
     67
     68	000336				W.ESC:
     69	000336	005000 				clr	r0
     70	000340					GETPAR	#kb.map
     71	000350	013700 	144106 			mov	kb.esc, r0
     72	000354	004737 	000720'			call	map
     73	000360	112001 				movb	(r0)+,	r1
     74	000362	042701 	177400 			bic 	#177400,r1
     75	000366	006301 				asl	r1
     76	000370	016104 	003534'			mov	esc.tbl(r1), r4
     77	000374	105710 				tstb	(r0)
     78	000376	001464 				beq	90$
     79	000400	105761 	003535'			tstb	esc.tbl+1(r1)
     80	000404	001410 				beq	20$
     81	000406	100407 				bmi	20$
     82	000410				10$:
     83	000410	020427 	005742'			cmp	r4,	#esc.buf+1000
     84	000414	103004 				bcc	20$
     85	000416	105714 				tstb	(r4)
     86	000420	001402 				beq	20$
     87	000422	105024 				clrb	(r4)+
     88	000424	000771 				br	10$
     89	000426				20$:
     90	000426	013704 	004636'			MOV	ESC.HEAP,R4
     91	000432	020427 	005642'			cmp	r4, #esc.buf+1000-100
     92	000436	103444 				bcs	90$
     93					;................................
     94	000440					.push	<r0,r1,r2>	;
     95	000446	012704 	004742'			mov	#esc.buf, r4	; w.ptr
     96	000452	010400 				mov	r4,	r0	; r.ptr
     97	000454				30$:
     98	000454	020027 	005742'			cmp	r0,	#esc.buf+1000
     99	000460	103020 				bhis	80$
    100	000462	105710 				tstb	(r0)
    101	000464	001002 				bne	40$
    102	000466	005200 				inc	r0
    103	000470	000771 				br	30$
    104	000472				40$:
    105	000472	012701 	003534'			mov	#esc.tbl, r1
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-2
Common definitions for bios monitor

    106	000476	012702 	000400 			mov	#256.,	r2
    107	000502				50$:
    108	000502	020021 				cmp	r0,	(r1)+
    109	000504	001402 				beq	60$
    110	000506	077203 				sob	r2,	50$
    111	000510	000000 			   halt
    112	000512				60$:
    113	000512	010441 				mov	r4,	-(r1)	; ptr
    114	000514				70$:
    115	000514	112024 				movb	(r0)+,	(r4)+
    116	000516	001376 				bne	70$
    117	000520	000755 				br	30$
    118	000522				80$:
    119	000522	010437 	004636'			mov	r4,	esc.heap
    120	000526	010402 				mov	r4,	r2
    121	000530				82$:
    122	000530	020227 	005742'			cmp	r2,	#esc.buf+1000
    123	000534	103002 				bhis	85$
    124	000536	105022 				clrb	(r2)+
    125	000540	000773 				br	82$
    126	000542				85$:
    127	000542					.pop	<r2,r1,r0>
    128					;................................
    129	000550				90$:
    130	000550	010461 	003534'		    	MOV	R4,     ESC.TBL(R1)
    131	000554	112024 				MOVB	(R0)+,	(R4)+
    132	000556	001036 				BNE	150$
    133
    134	000560	013704 	004634'			MOV	REQ.PTR,	R4
    135	000564	011000 				MOV	(R0),	R0
    136	000566	100017 				BPL	130$
    137	000570	020014 				CMP	R0,	(R4)
    138	000572	001411 				BEQ	120$
    139	000574					.push	r4
    140	000576				100$:
    141	000576	020427 	004634'			cmp	r4,#req.ptr
    142	000602	103003 				bcc	110$
    143	000604	020024 				cmp	r0,	(r4)+
    144	000606	001373 				bne	100$
    145	000610	005044 				clr	-(r4)
    146	000612				110$:
    147	000612					.pop	r4
    148	000614	000412 				br	140$
    149	000616				120$:
    150	000616	005724 				tst	(r4)+
    151	000620	005714 				tst	(r4)
    152	000622	001775 				beq	120$
    153	000624	000406 				br	140$
    154
    155	000626	052700 	100000 		130$:	BIS	#100000,R0
    156	000632	022704 	004534'			CMP	#REQ.TBL,R4
    157	000636	103001 				BCC	140$
    158	000640	010044 				MOV	R0,	-(R4)
    159	000642				140$:
    160	000642	010061 	003534'			MOV	R0,	ESC.TBL(R1)
    161	000646	010437 	004634'			MOV	R4,	REQ.PTR
    162	000652	000207 				RETURN
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-3
Common definitions for bios monitor

    163					;--------------------------------
    164	000654	105710 			150$:	TSTB	(R0)
    165	000656	001011 				BNE	170$
    166	000660	105044 				clrb	-(R4)
    167	000662	014004 				MOV	-(R0),   R4
    168	000664	105004 				CLRB	R4
    169	000666	000304 				SWAB	R4
    170	000670	010461 	003534'			MOV	R4,	ESC.TBL(R1)
    171	000674	000207 				RETURN
    172
    173	000676				160$:
    174	000676	112024 				MOVB	(R0)+,	(R4)+
    175	000700	001404 				BEQ	180$
    176	000702	020427 	005740'		170$:	cmp	r4,	#esc.buf+1000-2	;
    177
    178	000706	103773 				BCS	160$
    179	000710	105044 				CLRB	-(R4)
    180	000712				180$:
    181	000712	010437 	004636'			MOV	R4,	ESC.HEAP
    182	000716	000207 			190$: 	RETURN
    183					;--------------------------------
    184	000720				MAP:
    185	000720	010001 				mov	r0,	r1
    186	000722	072127 	177764 			ash	#-12.,	r1
    187	000726	042701 	177761 			bic	#^c16,	r1
    188	000732	062701 	004640'			add	#kb.map,r1
    189	000736	012137 	161224 			mov	(r1)+,	ur2
    190	000742	011137 	161226 			mov	(r1),	ur3
    191	000746	042700 	160000 		     	bic	#160000,r0
    192	000752	052700 	040000 			bis	#40000, r0
    193	000756	000207 				return
    194					;--------------------------------
    195	000760				WC.BUF:
    196	000760	005000 				clr	r0
    197	000762					GETPAR	#kb.map
    198	000772	013700 	144110 			MOV	CB.BUF, R0
    199	000776	004737 	000720'			CALL	MAP
    200	001002	012701 	000020 			MOV	#20,	R1
    201	001006	112002 			20$:	MOVB	(R0)+,	R2
    202	001010	001403 				BEQ	30$
    203	001012	004737 	002142'			CALL	W.CBUF
    204	001016	077105 				SOB	R1,	20$
    205
    206	001020				30$:
    207	001020	032777 	000200 	003642 		BIT	#200,	@KS.COPY
    208	001026	001002 				BNE	40$
    209	001030	000137 	002204'			JMP	R.KB10
    210	001034				40$:
    211	001034	000207 				RETURN
    212
    213					;================================
    214	001036				KBE.INT:			;
    215	001036	012737 	000020 	004660'		MOV	#M.KBD, KB.MASK	;
    216	001044	012737 	000120 	161066 		MOV	#120,	KBDCSR	;
    217	001052	012700 	004702'			MOV	#KBUF0, R0	;
    218	001056	012701 	004722'			MOV	#KBUF1, R1	;
    219	001062	012705 	000010 			MOV	#8.,	R5	;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-4
Common definitions for bios monitor

    220					;................................
    221	001066	013704 	161064 		10$:	MOV	KBDBUF, R4	;
    222	001072	011011 				MOV	(R0),	(R1)	;
    223	001074	010403 				MOV	R4,	R3	;
    224	001076	042703 	000007 			BIC	#7,	R3	;
    225	001102	006303 				ASL	R3		;
    226	001104	006303 				ASL	R3		;
    227	001106	006303 				ASL	R3		;
    228	001110	042704 	177770 			BIC	#^C7,	R4	;
    229	001114	156403 	002362'			BISB	TBL1(R4),R3	;
    230	001120	074321 				XOR	R3,	(R1)+	;
    231	001122	010320 				MOV	R3,	(R0)+	;
    232	001124	077520 				SOB	R5,	10$	;
    233	001126	012737 	000302 	161066 	        MOV	#302,	KBDCSR	;
    234					;................................
    235	001134	005037 	004674'			CLR	CTRL		;
    236	001140	005037 	004700'			CLR     ESC.M		;
    237	001144	042737 	000022 	004676'		bic	#<t$graf!t$shft>, t$$
    238	001152	012705 	002000 			MOV	#2000,  R5	;
    239	001156	012704 	004712'			MOV	#KBUF0+10,R4	;
    240					;................................
    241	001162	030537 	004710'			BIT	R5,	KBUF0+6 ; GRAPH
    242	001166	001407 				BEQ	20$		;
    243	001170	040537 	004710'			BIC	R5,	KBUF0+6 ;
    244	001174	040537 	004730'			BIC	R5,	KBUF1+6 ;
    245	001200	052737 	000020 	004676'		bis	#t$graf, t$$
    246	001206				20$:				;
    247	001206	030537 	004706'		    	BIT	R5,	KBUF0+4 ;
    248	001212	001412 				BEQ	30$		;
    249	001214	040537 	004706'		 	BIC	R5,	KBUF0+4 ; CTRL
    250	001220	040537 	004726'		  	BIC	R5,	KBUF1+4 ;
    251	001224	112737 	000340 	004674'	   	MOVB	#340,	CTRL	;
    252	001232	052737 	000040 	004700'	    	BIS	#40,    ESC.M	;
    253	001240				30$:				;
    254	001240	006005 			     	ROR	R5		;
    255	001242	030514 				BIT	R5,	(R4)	;
    256	001244	001414 				BEQ	40$		;
    257	001246	040514 			     	BIC	R5,	(R4)	; SHIFT
    258	001250	040537 	004732'			BIC	R5,	KBUF1+10;
    259	001254	112737 	000040 	004675'	      	MOVB	#40,	SHIFT	;
    260	001262	052737 	000100 	004700'	        BIS 	#100,	ESC.M	;
    261	001270	052737 	000002 	004676'		bis	#t$shft, t$$
    262	001276				40$:				;
    263	001276	006214 			     	ASR	(R4)		;
    264	001300	103006 				BCC	50$		;
    265	001302	042737 	000001 	004732'		BIC	#1,	KBUF1+10; ALT (fiks)
    266	001310	052737 	000200 	004700'	      	BIS	#200,	ESC.M	;
    267	001316	006314 			50$:	ASL	(R4)		;
    268					;................................
    269	001320	030537 	004706'			bit	r5,	kbuf0+4	;
    270	001324	001407 				beq	60$		;
    271	001326	040537 	004706'			bic	r5,	kbuf0+4	;
    272	001332	040537 	004726'			bic	r5,	kbuf1+4	;
    273	001336	052737 	000004 	100036 		bis	#c.hlt,	VRQFLG	;
    274	001344				60$:				;
    275					;--------------------------------
    276	001344	012705 	000010 		70$:	MOV	#8.,	R5	;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-5
Common definitions for bios monitor

    277	001350	012702 	177777 			MOV	#-1,	R2	;
    278									;
    279	001354	014004 			80$:	MOV	-(R0),  R4	;
    280	001356	005741 				TST	-(R1)		;
    281	001360	001004 				BNE	110$		;
    282	001362	062702 	000013 		90$:	ADD	#11.,   R2	;
    283	001366	077506 				SOB	R5,	80$	;
    284	001370				100$:
    285	001370	000207 				RETURN			;
    286					;................................
    287	001372	005704 			110$:	TST	R4		;
    288	001374	001021 				bne	140$
    289	001376					.push	<r2,r4>
    290	001402	011104 				mov	(r1),	r4
    291	001404	006004 			120$:	ROR	R4		;
    292	001406	005202 				INC	R2		;
    293	001410	103375 				BCC	120$		;
    294	001412	020237 	004662'			cmp	r2,	KB.SYM
    295	001416	001003 				bne	130$
    296	001420	012737 	177777 	004662'		mov	#-1,	KB.SYM
    297	001426				130$:
    298	001426	005704 				tst	r4
    299	001430	001365 				bne	120$
    300	001432					.pop	<r4,r2>
    301	001436	000751 				br	90$
    302	001440	006004 			140$:	ROR	R4		;
    303	001442	005202 				INC	R2		;
    304	001444	103375 				BCC	140$		;
    305	001446	020237 	004662'			cmp	r2,	KB.SYM
    306	001452	001746 				beq	100$
    307	001454	010237 	004662'			MOV	R2,	KB.SYM	;
    308	001460	012737 	000031 	004664'		MOV	#T.WAIT,KB.TIME	;
    309	001466	012737 	000420 	004660'		MOV	#M.KBD+M.TIO, KB.MASK
    310	001474	000405 				BR	K26$		;
    311					;--------------------------------
    312	001476	013702 	004662'		K.REPT: MOV	KB.SYM, R2	;
    313	001502	012737 	000005 	004664'		MOV	#T.REPT,KB.TIME	;
    314	001510				K26$:				;
    315	001510	122702 	000053 			CMPB	#53,	R2	;ALPH
    316	001514	001045 				BNE	40$		;
    317	001516	105737 	004675'			TSTB	SHIFT		;
    318	001522	001021 				BNE	20$		;
    319	001524	012705 	000004 			MOV	#t$caps, R5	;
    320	001530	074537 	004676'			XOR	R5,	t$$	;CAPS
    321	001534	030537 	004676'			BIT	R5,	t$$	;
    322	001540	001405 				BEQ	10$		;
    323	001542					DCHAR	#7.*400+62	;
    324	001552	000207 				RETURN			;
    325	001554				10$:
    326	001554					DCHAR	#7.*400		;
    327	001564	000207 				RETURN			;
    328					;................................
    329	001566	012705 	000010 		20$:	MOV	#t$rus,	R5	;
    330	001572	074537 	004676'			XOR	R5,	t$$	;LAT
    331	001576	030537 	004676'			BIT     R5,     t$$
    332	001602	001405 				BEQ	30$		;
    333	001604					DCHAR	#8.*400		;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-6
Common definitions for bios monitor

    334	001614	000207 				RETURN			;
    335	001616				30$:
    336	001616					DCHAR	#8.*400+70	;
    337	001626	000207 				RETURN			;
    338					;--------------------------------
    339	001630				40$:	DSTRING #150$		;
    340	001640	116202 	003404'			MOVB	TBL2(R2),R2	;
    341	001644	100434 				BMI	80$		;
    342	001646	105737 	004674'			tstb	ctrl
    343	001652	001410 				beq	50$
    344	001654	116202 	002432'			movb	t$0000(r2), r2
    345	001660	120227 	000100 			cmpb	r2,	#100
    346	001664	103412 				bcs	60$
    347	001666	042702 	000340 			bic	#340,	r2
    348	001672	000407 				br	60$
    349	001674				50$:
    350	001674	013705 	004676'			mov	t$$,	r5
    351	001700	016505 	002372'			mov	t$tbl(r5), r5
    352	001704	060205 				add	r2,	r5
    353	001706	005002 				clr	r2
    354	001710	151502 				bisb	(r5),	r2
    355	001712				60$:
    356	001712	010237 	002136'			MOV	R2,	160$
    357	001716	013705 	004634'			MOV	REQ.PTR,R5
    358	001722	022705 	004634'			CMP	#REQ.PTR,R5
    359					;	BEQ	70$
    360	001726	001043 				bne	95$
    361					;	DVAL	#160$
    362					;	MOV	R2,	@(R5)+
    363					;	RETURN
    364
    365	001730	004737 	002142'		70$:	CALL	W.CBUF
    366	001734	000465 				BR	130$
    367
    368	001736	042702 	177740 		80$:	BIC	#177740,R2
    369	001742	063702 	004700'			ADD 	ESC.M,	R2
    370	001746	010237 	002136'			MOV	R2,	160$
    371	001752	052737 	000400 	002136'		BIS	#400,	160$
    372	001760				      	DVAL	#160$
    373	001770					DCHAR	#<4*400>+170
    374	002000	006302 				ASL	R2
    375	002002	016203 	003534'			MOV	ESC.TBL(R2),R3
    376	002006	100006 				BPL	90$
    377	002010	013713 	002136'			MOV	160$,	(R3)
    378	002014	103002 				bcc	89$
    379	002016	005062 	003534'			clr	ESC.TBL(r2)		; reg not reply
    380	002022				89$:
    381	002022	000207 				RETURN
    382	002024				90$:
    383	002024	013705 	004634'			MOV	REQ.PTR,R5
    384	002030	022705 	004634'		     	CMP	#REQ.PTR,R5
    385	002034	001411 				BEQ	110$
    386	002036				95$:
    387	002036	013735 	002136'			MOV	160$,	@(R5)+
    388					;+
    389	002042	103005 				bcc	100$
    390	002044				96$:
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-7
Common definitions for bios monitor

    391	002044	005725 				tst	(r5)+
    392	002046	001776 				beq	96$
    393	002050	005745 				tst	-(r5)
    394	002052	010537 	004634'			mov	r5, REQ.PTR
    395					;-
    396	002056				100$:
    397	002056	000207 				RETURN
    398	002060				110$:
    399	002060	010302 				MOV	R3,R2
    400	002062	032702 	177400 			BIT	#177400,R2
    401	002066	001003 				BNE	120$
    402	002070	105702 				TSTB	R2
    403	002072	001307 				BNE	60$
    404	002074	000207 				RETURN
    405
    406	002076	112302 			120$:	MOVB	(R3)+,	R2
    407	002100	001407 				BEQ	140$
    408	002102	004737 	002142'			CALL	W.CBUF
    409	002106	000773 				BR	120$
    410
    411	002110				130$:	DVAL	#160$
    412	002120	032777 	000200 	002542 	140$:	BIT	#200,	@KS.COPY
    413	002126	001426 				BEQ	R.KB10
    414	002130	000207 				RETURN
    415					;................................
    416	002132	   043 	   002 	   333 	150$:	.BYTE 2*16.+3,2,333     ;A-
    417					.EVEN
    418	002136	000000 	004060 		160$:	.WORD	0,8.*400+<3*16.>
    419					;================================
    420	002142	013705 	000244'		W.CBUF: MOV	WR.PTR, R5	;
    421	002146	110225 				MOVB	R2,	(R5)+	;
    422	002150	020527 	000244'			CMP	R5,	#WR.PTR	;
    423	002154	001002 			 	BNE	110$		;
    424	002156	012705 	000002'			MOV	#RD.PTR+2,R5	;
    425	002162	020537 	000000'		110$:	CMP	R5,	RD.PTR	;
    426	002166	001402 				BEQ	111$		;
    427	002170	010537 	000244'			MOV	R5,	WR.PTR	;
    428	002174	000207 			111$:	RETURN			;
    429					;................................
    430	002176				R.KBUF::			;
    431	002176	113737 	004667'	004666'		MOVB	KB.CS1, KB.CS0	;
    432	002204	013705 	000000'		R.KB10: MOV	RD.PTR, R5	;
    433	002210	020537 	000244'			CMP	R5,     WR.PTR	;
    434	002214	001006 				BNE	5$		;
    435	002216	005077 	002446 		     	CLR	@KS.COPY	;
    436	002222	042737 	000200 	147560 	        BIC	#200,   KB.CSR	;
    437	002230	000207 			     	RETURN			;
    438	002232				5$:				;
    439	002232	111537 	147562 			MOVB	(R5),   KB.BUF	;
    440	002236	112577 	002430 			MOVB	(R5)+,	@KB.COPY;
    441	002242	020527 	000244'			CMP	R5,     #WR.PTR	;
    442	002246	001002 				BNE	10$		;
    443	002250	012705 	000002'			MOV	#RD.PTR+2,R5	;
    444	002254	010537 	000000'		10$:	MOV	R5,	RD.PTR	;
    445
    446	002260	052777 	000200 	002402 		BIS	#200,	@KS.COPY
    447	002266	052737 	000200 	147560 		BIS	#200,	KB.CSR
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-8
Common definitions for bios monitor

    448	002274	133777 	004666'	002366 	K.VRQ:	BITB	KB.CS0, @KS.COPY
    449	002302	001406 				BEQ	RET
    450	002304					SETINT	#KBVEC
    451	002314	105037 	004666'			CLRB	KB.CS0
    452	002320	000207 			RET:	RETURN
    453
    454	002322				W.KCSR::
    455	002322	013700 	147560 		        MOV     KB.CSR, R0
    456	002326	106300 				ASLB	R0
    457	002330	120037 	004667'			CMPB	R0,	KB.CS1
    458	002334	001411 				BEQ	10$
    459	002336	110037 	004667'			MOVB	R0,	KB.CS1
    460	002342	110037 	004666'			MOVB	R0,	KB.CS0
    461	002346	001352 				BNE	K.VRQ
    462	002350					RESINT	#KBVEC
    463	002360	000207 			10$:	RETURN
    464
    465	002362	   000 	   001 	   002 	TBL1:	.BYTE   0,1,2,4,10,20,40,0
	002365	   004 	   010 	   020
	002370	   040 	   000
    466
    467					;----------------------------------------------------------------
    468		000002 			t$shft	= 002
    469		000004 			t$caps	= 004
    470		000010 			t$rus	= 010
    471		000020 			t$graf	= 020
    472	002372	002432'	002513'	002574'	t$tbl::	.word	t$0000, t$000s, t$00c0, t$00cs
	002400	002655'
    473	002402	002736'	003017'	003100'		.word	t$0r00, t$0r0s, t$0rc0, t$0rcs
	002410	003161'
    474	002412	003242'	003323'	003242'		.word	t$g000, t$g00s, t$g000, t$g00s
	002420	003323'
    475	002422	003242'	003323'	003242'		.word	t$g000, t$g00s, t$g000, t$g00s
	002430	003323'
    476					;----------------------------------------------------------------
    477	002432	   073 	   061 	   062 	t$0000:	.ascii	";1234567890-:jcukeng[]zh_/fywaproldv\.q^smitxb@, "
	002435	   063 	   064 	   065
	002440	   066 	   067 	   070
	002443	   071 	   060 	   055
	002446	   072 	   152 	   143
	002451	   165 	   153 	   145
	002454	   156 	   147 	   133
	002457	   135 	   172 	   150
	002462	   137 	   057 	   146
	002465	   171 	   167 	   141
	002470	   160 	   162 	   157
	002473	   154 	   144 	   166
	002476	   134 	   056 	   161
	002501	   136 	   163 	   155
	002504	   151 	   164 	   170
	002507	   142 	   100 	   054
	002512	   040
    478	002513	   053 	   041 	   042 	t$000s:	.ascii	-+!"#$%&'()0=*JCUKENG{}ZH ?FYWAPROLDV|>Q~SMITXB`< -
	002516	   043 	   044 	   045
	002521	   046 	   047 	   050
	002524	   051 	   060 	   075
	002527	   052 	   112 	   103
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-9
Common definitions for bios monitor

	002532	   125 	   113 	   105
	002535	   116 	   107 	   173
	002540	   175 	   132 	   110
	002543	   040 	   077 	   106
	002546	   131 	   127 	   101
	002551	   120 	   122 	   117
	002554	   114 	   104 	   126
	002557	   174 	   076 	   121
	002562	   176 	   123 	   115
	002565	   111 	   124 	   130
	002570	   102 	   140 	   074
	002573	   040
    479	002574	   073 	   061 	   062 	t$00c0:	.ascii	";1234567890-:JCUKENG[]ZH_/FYWAPROLDV\.Q^SMITXB@, "
	002577	   063 	   064 	   065
	002602	   066 	   067 	   070
	002605	   071 	   060 	   055
	002610	   072 	   112 	   103
	002613	   125 	   113 	   105
	002616	   116 	   107 	   133
	002621	   135 	   132 	   110
	002624	   137 	   057 	   106
	002627	   131 	   127 	   101
	002632	   120 	   122 	   117
	002635	   114 	   104 	   126
	002640	   134 	   056 	   121
	002643	   136 	   123 	   115
	002646	   111 	   124 	   130
	002651	   102 	   100 	   054
	002654	   040
    480	002655	   053 	   041 	   042 	t$00cs:	.ascii	-+!"#$%&'()0=*jcukeng{}zh ?fywaproldv|>q~smitxb`< -
	002660	   043 	   044 	   045
	002663	   046 	   047 	   050
	002666	   051 	   060 	   075
	002671	   052 	   152 	   143
	002674	   165 	   153 	   145
	002677	   156 	   147 	   173
	002702	   175 	   172 	   150
	002705	   040 	   077 	   146
	002710	   171 	   167 	   141
	002713	   160 	   162 	   157
	002716	   154 	   144 	   166
	002721	   174 	   076 	   161
	002724	   176 	   163 	   155
	002727	   151 	   164 	   170
	002732	   142 	   140 	   074
	002735	   040
    481
    482	002736	   073 	   061 	   062 	t$0r00:	.ascii	";1234567890-:ûÔÖçóùñÕÈâÅÉ/ÄÊðïúÞ÷øòæÌ.ÎÃÀýüÁËÿÍ, "
	002741	   063 	   064 	   065
	002744	   066 	   067 	   070
	002747	   071 	   060 	   055
	002752	   072 	   331 	   346
	002755	   343 	   332 	   325
	002760	   335 	   323 	   350
	002763	   351 	   327 	   345
	002766	   352 	   057 	   344
	002771	   353 	   322 	   320
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-10
Common definitions for bios monitor

	002774	   337 	   340 	   336
	002777	   333 	   324 	   326
	003002	   355 	   056 	   357
	003005	   347 	   341 	   334
	003010	   330 	   342 	   354
	003013	   321 	   356 	   054
	003016	   040
    483	003017	   053 	   041 	   042 	t$0r0s:	.ascii	-+!"#$%&'()0=*9ôö:5=3õè7åé?äê20?þ>;46ì>îãà<8áë1í< -
	003022	   043 	   044 	   045
	003025	   046 	   047 	   050
	003030	   051 	   060 	   075
	003033	   052 	   271 	   306
	003036	   303 	   272 	   265
	003041	   275 	   263 	   310
	003044	   311 	   267 	   305
	003047	   312 	   077 	   304
	003052	   313 	   262 	   260
	003055	   277 	   300 	   276
	003060	   273 	   264 	   266
	003063	   315 	   076 	   317
	003066	   307 	   301 	   274
	003071	   270 	   302 	   314
	003074	   261 	   316 	   074
	003077	   040
    484	003100	   073 	   061 	   062 	t$0rc0:	.ASCII	";1234567890-:9ôö:5=3õè7åé/äê20?þ>;46ì.îãà<8áë1í, "
	003103	   063 	   064 	   065
	003106	   066 	   067 	   070
	003111	   071 	   060 	   055
	003114	   072 	   271 	   306
	003117	   303 	   272 	   265
	003122	   275 	   263 	   310
	003125	   311 	   267 	   305
	003130	   312 	   057 	   304
	003133	   313 	   262 	   260
	003136	   277 	   300 	   276
	003141	   273 	   264 	   266
	003144	   315 	   056 	   317
	003147	   307 	   301 	   274
	003152	   270 	   302 	   314
	003155	   261 	   316 	   054
	003160	   040
    485	003161	   053 	   041 	   042 	t$0rcs:	.ascii	-+!"#$%&'()0=*ûÔÖçóùñÕÈâÅÉ?ÄÊðïúÞ÷øòæÌ>ÎÃÀýüÁËÿÍ< -
	003164	   043 	   044 	   045
	003167	   046 	   047 	   050
	003172	   051 	   060 	   075
	003175	   052 	   331 	   346
	003200	   343 	   332 	   325
	003203	   335 	   323 	   350
	003206	   351 	   327 	   345
	003211	   352 	   077 	   344
	003214	   353 	   322 	   320
	003217	   337 	   340 	   336
	003222	   333 	   324 	   326
	003225	   355 	   076 	   357
	003230	   347 	   341 	   334
	003233	   330 	   342 	   354
	003236	   321 	   356 	   074
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-11
Common definitions for bios monitor

	003241	   040
    486
    487	003242	   073 	   245 	   244 	t$g000: .ascii	';%$367890 &!
/)*'#("	? '
	003245	   063 	   225 	   224
	003250	   066 	   067 	   070
	003253	   071 	   060 	   201
	003256	   213 	   240 	   246
	003261	   241 	   220 	   226
	003264	   221 	   212 	   202
	003267	   206 	   217 	   207
	003272	   205 	   057 	   251
	003275	   252 	   247 	   231
	003300	   232 	   227 	   215
	003303	   237 	   203 	   216
	003306	   236 	   204 	   243
	003311	   250 	   242 	   223
	003314	   230 	   222 	   211
	003317	   200 	   214 	   210
	003322	   040
    488					;		 ;1234567890-:jcukeng[]zh_/fywaproldv\.q^smitxb@,
    489	003323	   360 	   361 	   042 	t$g00s: .ascii	'Ïß"ÝÙ-./+,ØÇÆÂÜÛÑÐÓÒ{}ZH_×APROLDV|>Q~SMITXB`< '
	003326	   374 	   375 	   255
	003331	   256 	   257 	   253
	003334	   254 	   373 	   372
	003337	   366 	   367 	   370
	003342	   371 	   363 	   362
	003345	   365 	   364 	   173
	003350	   175 	   132 	   110
	003353	   137 	   233 	   234
	003356	   235 	   376 	   101
	003361	   120 	   122 	   117
	003364	   114 	   104 	   126
	003367	   174 	   076 	   121
	003372	   176 	   123 	   115
	003375	   111 	   124 	   130
	003400	   102 	   140 	   074
	003403	   040
    490
    491										;217,237
    492					;	.	.    .    .    .    .    .    .    .    .    .    .
    493					;----------------------------------------------------------------------
    494	003404				TBL2:	;	3#   6#  ?><  à1þ>à -	 9    :    /   0     9#   22>4
    495	003404	   203 	   206 	   220 		.byte  203, 206, 220, 221, 13,	11,  14,  31, 12,   211,  216
	003407	   221 	   013 	   011
	003412	   014 	   031 	   012
	003415	   211 	   216
    496					;----------------------------------------------------------------------
    497						;	2#   5#  öàá  8à?   _	 Z   CR    Ü	H    8#   .#
    498	003417	   202 	   205 	   222 		.byte  202, 205, 222, 223, 30,	26, 217,  224, 27,  210, 212
	003422	   223 	   030 	   026
	003425	   217 	   224 	   027
	003430	   210 	   212
    499					;----------------------------------------------------------------------
    500						;	1#   4#   BS   +#   .	 V    Æ    Û	\    7#   0#
    501	003432	   201 	   204 	   237 		.byte  201, 204, 237, 213, 45,	43,  225, 226, 44,  207, 200
	003435	   213 	   045 	   043
	003440	   225 	   226 	   044
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-12
Common definitions for bios monitor

	003443	   207 	   200
    502					;----------------------------------------------------------------------
    503						;      ä8:à  ^	  M    S    X	 ,    SP   T	Â	  0;ä
    504	003445	   000 	   047 	   051 		.byte  000, 47,  51,  50,  54,	57,  60,  53,  227, 0,	  1
	003450	   050 	   054 	   057
	003453	   060 	   053 	   227
	003456	   000 	   001
    505					;----------------------------------------------------------------------
    506						;	Q    Y	  A    W    O	 @    I    R	B	  3þ0ä
    507	003460	   046 	   033 	   035 		.byte  46,  33,  35,  34,  40,	56,  52,  37,  55,  0,	  2
	003463	   034 	   040 	   056
	003466	   052 	   037 	   055
	003471	   000 	   002
    508					;----------------------------------------------------------------------
    509						;	F    C	  K    U    G	 D    P    N	L
    510	003473	   032 	   016 	   020 		.byte  32,  16,  20,  17,  23,	42,  36,  22,  41,  0,	 0
	003476	   017 	   023 	   042
	003501	   036 	   022 	   041
	003504	   000 	   000
    511					;----------------------------------------------------------------------
    512						;	J    1	  3    2    6	 ]    E    5	[    -#  á01
    513	003506	   015 	   001 	   003 		.byte  15,   1,   3,   2,   6,	25,  21,   5,  24,  214, 230
	003511	   002 	   006 	   025
	003514	   021 	   005 	   024
	003517	   214 	   230
    514					;----------------------------------------------------------------------
    515						;	;    K1   K3   K2   K5	 8    4    K4	7    ,#  0þ2
    516	003521	   000 	   231 	   232 		.byte	0,  231, 232, 233, 234, 10,   4,  235,	7,  215, 236
	003524	   233 	   234 	   010
	003527	   004 	   235 	   007
	003532	   215 	   236
    517					;----------------------------------------------------------------------
    518					.IIF NE .-TBL2-88. .ERROR
    519					;----------------------------------------------------------------
    520	003534				ESC.TBL:
    521	003534	004742'	004746'	004752'	.WORD	K0,	K1,	K2,	K3,	K4,	K5,	K6,	K7
	003542	004756'	004762'	004766'
	003550	004772'	004776'
    522	003554	005002'	005006'	005022'	.WORD	K10,	K11,	K12,	K13,	K14,	K15,	K16,	CR
	003562	005052'	005012'	005016'
	003570	005026'	000015
    523	003574	005056'	000000 	005062'	.WORD	K20,	0,	K22,	K23,	K24,	K25,	K26,	K27
	003602	005066'	005032'	005042'
	003610	005036'	005046'
    524	003614	000011 	000003 	000002 	.WORD	11,	3,	2,	1,	37,	14,	33,	177
	003622	000001 	000037 	000014
	003630	000033 	000177
    525	003634	005072'	005076'	005102'	.WORD	K40,	K41,	K42,	K43,	K44,	K45,	K46,	K47
	003642	005106'	005112'	005116'
	003650	005122'	005126'
    526	003654	005132'	005136'	005162'	.WORD	K50,	K51,	K52,	K53,	K54,	K55,	K56,	0
	003662	005156'	005172'	005175'
	003670	005166'	000000
    527	003674	000016 	000000 	005161'	.WORD	K60,	0,	K62,	K63,	K64,	K65,	K66,	K67
	003702	000017 	005142'	005150'
	003710	005145'	005153'
    528	003714	000000 	000000 	000000 	.WORD	0,	0,	0,	0,	0,	0,	0,	0
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-13
Common definitions for bios monitor

	003722	000000 	000000 	000000
	003730	000000 	000000
    529	003734					.BLKW	300
    530					;----------------------------------------------------------------
    531	004534				REQ.TBL:  .blkw	40
    532	004634				REQ.PTR:  .blkw	1
    533	004636				ESC.HEAP: .blkw	1
    534					;--------------------------------
    535	004640				kb.map:	.blkw	8.		; UR's of caller
    536					;-----------------------------------
    537	004660				KB.MASK:  .blkw	1
    538	004662				KB.SYM:	  .blkw	1
    539	004664				KB.TIM:	  .blkw	1
    540	004666				KB.CS0:	  .blkb	1
    541	004667				KB.CS1:	  .blkb	1
    542	004670				KS.COPY:  .blkw	1
    543	004672				KB.COPY:  .blkw	1
    544	004674				CTRL:	  .blkb	1
    545	004675				SHIFT:	  .blkb	1
    546	004676	000000 			t$$:	  .word	0		; ÁïÿøüÔï
    547	004700				ESC.M:	  .blkw	1
    548	004702				KBUF0:    .blkw	8.
    549	004722				KBUF1:    .blkw	8.
    550					;----------------------------------------------------------------
    551	004742				esc.buf:
    552
    553					;--------------------------------
    554					;	Macro 'k' add ESC char
    555					.macro  k       str
    556					        .byte   33
    557					        .asciz  "'str'"
    558					.endm   k
    559					;********************
    560					;	Macro 'ke' NOT add ESC
    561					.macro  ke      kod, str
    562					        .byte   str
    563					.endm   ke
    564					;-----------------------------------
    565					;   key-code    ESC<string>     KEY
    566					;-----------------------------------
    567					;       for  VT100
    568	004742				k0:	K	<Op>		; 0
    569	004746				k1:	K	<Oq>		; 1
    570	004752				k2:	K	<Or>		; 2
    571	004756				k3:	K	<Os>		; 3
    572	004762				k4:	K	<Ot>		; 4
    573	004766				k5:	K	<Ou>		; 5
    574	004772				k6:	K	<Ov>		; 6
    575	004776				k7:	K	<Ow>		; 7
    576	005002				k10:	K	<Ox>		; 8
    577	005006				k11:	K	<Oy>		; 9
    578
    579	005012				k14:	K	<Om>		; -
    580	005016				k15:	K	<Ol>		; ,
    581	005022				k12:	K	<On>		; .
    582	005026				k16:	K	<OM>		; ENTER
    583
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-14
Common definitions for bios monitor

    584	005032				k24:	K	<[A>		; CUP
    585	005036				k26:	K	<[B>		; CUD
    586	005042				k25:	K	<[C>		; CUR
    587	005046				k27:	K	<[D>		; CUL
    588
    589	005052				k13:	K	<OP>		; +     (PF1)
    590	005056				k20:	K	<OQ>		; POM   (PF2)
    591	005062				k22:	K	<OR>		; UST   (PF3)
    592	005066				k23:	K	<OS>		; ISP   (PF4)
    593
    594					;--------------------------------
    595					;       for  VT52
    596					; +shift=100
    597					; +ctrl = 40
    598	005072				k40:	K	<?p>		; 0
    599	005076				k41:	K	<?q>		; 1
    600	005102				k42:	K	<?r>		; 2
    601	005106				k43:	K	<?s>		; 3
    602	005112				k44:	K	<?t>		; 4
    603	005116				k45:	K	<?u>		; 5
    604	005122				k46:	K	<?v>		; 6
    605	005126				k47:	K	<?w>		; 7
    606	005132				k50:	K	<?x>		; 8
    607	005136				k51:	K	<?y>		; 9
    608
    609	005142				k64:	K	<A>		; CUP
    610	005145				k66:	K	<B>		; CUD
    611	005150				k65:	K	<C>		; CUR
    612	005153				k67:	K	<D>		; CUL
    613
    614	005156				k53:	K	<P>		; +     (PF1)
    615		000016 			k60 	=	16		; POM (RUS)
    616	005161				k62:	Ke	<33,10>		; UST (HOME)
    617		000017 			k63	=	17		; ISP (LAT)
    618	005162				k52:	K	<?n>		; .
    619	005166				k56:	K	<?M>		; CR
    620
    621	005172				k54:	K	<Q>		; -  (PF2)
    622	005175				k55:	K	<R>		; ,  (PF3)
    623
    624	005200				ESC$HEAP:
    625
    626		005742'			. = ESC.BUF+1000
    627
    628	005742	000000 				.WORD	0
    629
    630		001064 			kb$dat	= . - kb.mask
    631
    632		000001 			.end
Errors detected:  0

*** Assembler statistics


Work  file  reads: 0
Work  file writes: 0
Size of work file: 10040 Words  ( 40 Pages)
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-15
Common definitions for bios monitor

Size of core pool: 15616 Words  ( 61 Pages)
Operating  system: RT-11

Elapsed time: 00:00:00.13
DK:P16KBE,DK:P16KBE=DK:P16,DK:P16KBE
